module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.extensions["askvortsov-rich-text"]},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},function(t,e,n){"use strict";n.r(e);var r=n(0),o=n(2),c=n.n(o);function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function a(t){return"paragraph_open"===t.type}function s(t){return"inline"===t.type}var u=function(t){for(var e=!1,n=t.tokens,r=n.length-3;r>=0;r--)if("list_item_open"===n[r].type&&a(n[r+1])&&s(n[r+2])){var o=n[r+2],c=/^\[([ |x|X])\]\s?/.exec(o.content);if(c){var i="x"===c[1]||"X"===c[1];o.content=o.content.slice(c[0].length),o.children[0].content=o.content;var u=new(Object.getPrototypeOf(t).Token)("list_checkbox","input",0);u.hidden=!0,u.attrPush(["type","checkbox"]),i&&u.attrPush(["checked",""]),n.splice(r+1,0,u),e=!0}}return e};var d=function(t){t.core.ruler.push("markdown-it-list-checkbox",u)},l=function(){function t(t,e,n){this.dom=this.contentDOM=document.createElement("li"),this.schema=e.state.schema,this.recalcTaskStatus(t)}var e=t.prototype;return e.update=function(t){this.recalcTaskStatus(t)},e.recalcTaskStatus=function(t){t.content.content[0]&&"list_checkbox"===t.content.content[0].type.name?(this.contentDOM.setAttribute("data-task-id",""),this.contentDOM.setAttribute("data-task-state",t.content.content[0].attrs.checked?"checked":"unchecked")):(this.contentDOM.removeAttribute("data-task-id"),this.contentDOM.removeAttribute("data-task-state"))},t}(),p=function(t,e,n){var r=!!t.attrs.checked,o=document.createElement("input");o.setAttribute("type","checkbox"),o.onclick=function(){var t=n();r=!r,e.dispatch(e.state.tr.setNodeMarkup(t,void 0,{checked:r}))},t.attrs.checked&&o.setAttribute("checked",""),this.dom=this.contentDom=o};function f(){if("askvortsov-rich-text"in flarum.extensions){var t=n(1).proseMirror.markdown.MarkdownSerializerBuilder;Object(r.extend)(t.prototype,"buildNodes",(function(t){t.list_checkbox=function(t,e){t.text(e.attrs.checked?"[x] ":"[ ] ",!1)}}));var e=n(1).proseMirror.markdown.MarkdownParserBuilder;Object(r.extend)(e.prototype,"buildTokens",(function(t){i(t,{list_checkbox:{node:"list_checkbox",getAttrs:function(t){return{checked:""===t.attrGet("checked")}}}})})),Object(r.extend)(e.prototype,"buildTokenizer",(function(t){t.use(d)}));var o=n(1).proseMirror.markdown.SchemaBuilder;Object(r.override)(o.prototype,"buildNodes",(function(t){var e=t();return e.update("list_item",i({},e.get("list_item"),{content:"list_checkbox? paragraph block*"})).addBefore("list_item","list_checkbox",{defining:!0,group:"list_checkbox",attrs:{checked:{default:!1}},parseDOM:[{tag:"input[type=checkbox]",getAttrs:function(t){return isElementDOMNode(t)?{checked:t.hasAttribute("checked")}:{}}}],toDOM:function(t){var e={type:"checkbox"};return t.attrs.checked&&(e.checked=""),["input",e]}})}));var c=n(1).proseMirror.ProseMirrorEditorDriver;Object(r.extend)(c.prototype,"buildPluginItems",(function(t){t.add("checkboxEditorPlugin",new(0,n(1).Plugin)({props:{nodeViews:{list_checkbox:function(t,e,n){return new p(t,e,n)},list_item:function(t,e,n){return new l(t,e,n)}}}}))}));var a=n(1).InputRule;Object(r.extend)(c.prototype,"buildInputRules",(function(t){t.push(new a(/^\[([ |x])\] $/,(function(t,e,n,r){var o=t.selection.$from;if(o.depth>=3&&"list_item"===o.node(-1).type.name&&0===o.index(-1)){var c={checked:"x"===e[1]},i=o.before(-1);return t.tr.delete(n,r).insert(i+1,t.schema.nodes.list_checkbox.create(c))}return null})))})),Object(r.extend)(c.prototype,"buildPluginItems",(function(t){var e,r,o,c,i,a;t.add("checkListKeymap",n(1).keymap((e=this.schema,{Enter:(r=e.nodes.list_item,o=e.nodes.list_checkbox,c=n(1).liftListItem,i=n(1).splitListItem,a=n(1).Selection,function(t,e,n){var s,u=t.selection.$anchor.path;for(s=u.length-1;s>=0&&(!u[s].type||u[s].type!==r);s--);var d=u[s].content.content[0];if(!d||d.type!==o)return!1;var l=u[s].content.content[1];if(l&&!l.content.content.length)return e(n.state.tr.delete(u[s+2]-1,n.state.selection.to)),n.state.doc.resolve(n.state.selection.from-1),e(n.state.tr.setSelection(a.near(n.state.doc.resolve(t.selection.from-1)))),c(r)(t,e);if(!i(r)(t,e))return!1;var p=n.state.selection.$from.before(-1);return e(n.state.tr.insert(p+1,o.create({checked:!1}))),!0})})),10)}))}}app.initializers.add("askvortsov/flarum-checklist",(function(){function t(){var t=this.attrs.post;t.canEdit()&&this.$('input[type="checkbox"]').each((function(e,n){n.disabled=!1,n.onchange=function(){!function(t,e,n){for(var r,o=/([\-\*]|[0-9]+\.) (\[[ xX]\])/g,c=t.content();r=o.exec(c);){if(0===e){var i=r.index+r[0].length-2,a=c.substring(0,i)+(n?"x":" ")+c.substring(i+1);return void t.save({content:a}).then((function(){m.redraw()}))}e--}}(t,e,n.checked)}}))}Object(r.extend)(c.a.prototype,"oncreate",t),Object(r.extend)(c.a.prototype,"onupdate",t),f()}))}]);
//# sourceMappingURL=forum.js.map