module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=flarum.extensions["askvortsov-rich-text"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},function(t,e,n){"use strict";n.r(e);var r=n(1),o=n(2),c=n.n(o);function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a=function(){return function(t){var e,n;function r(){return t.apply(this,arguments)||this}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,s(e,n),r.prototype.onEditorUpdate=function(){var t,e=!0,n=this.state.editorView.state.selection.$anchor.path;for(t=n.length-1;t>=0&&(!n[t].type||n[t].type!==this.state.getSchema().nodes.list_item);t--);var r=n[t]&&n[t].content.content[0];r&&r.type===this.state.getSchema().nodes.list_checkbox||(e=!1),this.$().toggleClass("active",e)},r}(n(0).components.CommandButton)};function u(t){return"paragraph_open"===t.type}function p(t){return"inline"===t.type}var l=function(t){for(var e=!1,n=t.tokens,r=n.length-3;r>=0;r--)if("list_item_open"===n[r].type&&u(n[r+1])&&p(n[r+2])){var o=n[r+2],c=/^\[([ |x|X])\]\s?/.exec(o.content);if(c){var i="x"===c[1]||"X"===c[1];o.content=o.content.slice(c[0].length),o.children[0].content=o.content;var s=new(Object.getPrototypeOf(t).Token)("list_checkbox","input",0);s.hidden=!0,s.attrPush(["type","checkbox"]),i&&s.attrPush(["checked",""]),n.splice(r+1,0,s),e=!0}}return e};var d=function(t){t.core.ruler.push("markdown-it-list-checkbox",l)},h=function(){function t(t,e,n){this.dom=this.contentDOM=document.createElement("li"),this.schema=e.state.schema,this.recalcTaskStatus(t)}var e=t.prototype;return e.update=function(t){this.recalcTaskStatus(t)},e.recalcTaskStatus=function(t){t.content.content[0]&&"list_checkbox"===t.content.content[0].type.name?(this.contentDOM.setAttribute("data-task-id",""),this.contentDOM.setAttribute("data-task-state",t.content.content[0].attrs.checked?"checked":"unchecked")):(this.contentDOM.removeAttribute("data-task-id"),this.contentDOM.removeAttribute("data-task-state"))},t}(),f=function(t,e,n){var r=!!t.attrs.checked,o=document.createElement("input");o.setAttribute("type","checkbox"),o.onclick=function(){var t=n();r=!r,e.dispatch(e.state.tr.setNodeMarkup(t,void 0,{checked:r}))},t.attrs.checked&&o.setAttribute("checked",""),this.dom=this.contentDom=o};function k(){if("askvortsov-rich-text"in flarum.extensions){var t=n(0).components.ProseMirrorMenu,e=a();Object(r.extend)(t.prototype,"items",(function(t){var r,o,c,i;t.add("check_list",e.component({type:"check_list",icon:"fas fa-check-square",tooltip:app.translator.trans("askvortsov-checklist.forum.composer.checklist_tooltip"),state:this.attrs.state,command:(r=this.attrs.state.getSchema().nodes.bullet_list,o=this.attrs.state.getSchema().nodes.list_item,c=this.attrs.state.getSchema().nodes.list_checkbox,i=n(0).wrapInList,function(t,e,n){var s,a=t.selection.$anchor.path;for(s=a.length-1;s>=0&&(!a[s].type||a[s].type!==o);s--);for(s<0&&i(r)(n.state,n.dispatch),s=(a=n.state.selection.$anchor.path).length-1;s>=0&&(!a[s].type||a[s].type!==o);s--);var u=a[s]&&a[s].content.content[0];return u&&u.type===c?e(n.state.tr.delete(a[s+2]-1,a[s+2])):e(n.state.tr.insert(a[s+2],c.create({checked:!1}))),!0})}),10)}));var o=n(0).proseMirror.markdown.MarkdownSerializerBuilder;Object(r.extend)(o.prototype,"buildNodes",(function(t){t.list_checkbox=function(t,e){t.text(e.attrs.checked?"[x] ":"[ ] ",!1)}}));var c=n(0).proseMirror.markdown.MarkdownParserBuilder;Object(r.extend)(c.prototype,"buildTokens",(function(t){i(t,{list_checkbox:{node:"list_checkbox",getAttrs:function(t){return{checked:""===t.attrGet("checked")}}}})})),Object(r.extend)(c.prototype,"buildTokenizer",(function(t){t.use(d)}));var s=n(0).proseMirror.markdown.SchemaBuilder;Object(r.override)(s.prototype,"buildNodes",(function(t){var e=t();return e.update("list_item",i({},e.get("list_item"),{content:"list_checkbox? paragraph block*"})).addBefore("list_item","list_checkbox",{defining:!0,group:"list_checkbox",attrs:{checked:{default:!1}},parseDOM:[{tag:"input[type=checkbox]",getAttrs:function(t){return isElementDOMNode(t)?{checked:t.hasAttribute("checked")}:{}}}],toDOM:function(t){var e={type:"checkbox"};return t.attrs.checked&&(e.checked=""),["input",e]}})}));var u=n(0).proseMirror.ProseMirrorEditorDriver;Object(r.extend)(u.prototype,"buildPluginItems",(function(t){t.add("checkboxEditorPlugin",new(0,n(0).Plugin)({props:{nodeViews:{list_checkbox:function(t,e,n){return new f(t,e,n)},list_item:function(t,e,n){return new h(t,e,n)}}}}))}));var p=n(0).InputRule;Object(r.extend)(u.prototype,"buildInputRules",(function(t){t.push(new p(/^\[([ |x]?)\] $/,(function(t,e,n,r){var o=t.selection.$from;if(o.depth>=3&&"list_item"===o.node(-1).type.name&&0===o.index(-1)){var c={checked:"x"===e[1]},i=o.before(-1);return t.tr.delete(n,r).insert(i+1,t.schema.nodes.list_checkbox.create(c))}return null})))})),Object(r.extend)(u.prototype,"buildPluginItems",(function(t){var e,r,o,c,i,s;t.add("checkListKeymap",n(0).keymap((e=this.schema,{Enter:(r=e.nodes.list_item,o=e.nodes.list_checkbox,c=n(0).liftListItem,i=n(0).splitListItem,s=n(0).Selection,function(t,e,n){var a,u=t.selection.$anchor.path;for(a=u.length-1;a>=0&&(!u[a].type||u[a].type!==r);a--);var p=u[a]&&u[a].content.content[0];if(!p||p.type!==o)return!1;var l=u[a].content.content[1];if(l&&!l.content.content.length)return e(n.state.tr.delete(u[a+2]-1,n.state.selection.to)),n.state.doc.resolve(n.state.selection.from-1),e(n.state.tr.setSelection(s.near(n.state.doc.resolve(t.selection.from-1)))),c(r)(t,e);if(!i(r)(t,e))return!1;var d=n.state.selection.$from.before(-1);return e(n.state.tr.insert(d+1,o.create({checked:!1}))),!0})})),10)}))}}app.initializers.add("askvortsov/flarum-checklist",(function(){function t(){var t=this.attrs.post;t.canEdit()&&this.$('input[type="checkbox"]').each((function(e,n){n.disabled=!1,n.onchange=function(){!function(t,e,n){for(var r,o=/([\-\*]|[0-9]+\.) (\[[ xX]\])/g,c=t.content();r=o.exec(c);){if(0===e){var i=r.index+r[0].length-2,s=c.substring(0,i)+(n?"x":" ")+c.substring(i+1);return void t.save({content:s}).then((function(){m.redraw()}))}e--}}(t,e,n.checked)}}))}Object(r.extend)(c.a.prototype,"oncreate",t),Object(r.extend)(c.a.prototype,"onupdate",t),k()}))}]);
//# sourceMappingURL=forum.js.map