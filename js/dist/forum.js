module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e){t.exports=flarum.extensions["askvortsov-rich-text"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},,function(t,e){t.exports=flarum.core.compat["common/Application"]},,function(t,e,n){"use strict";n.r(e);var o=n(1),r=n(4),c=n.n(r),i=n(2),s=n.n(i);function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var p=function(){return function(t){var e,n;function o(){return t.apply(this,arguments)||this}return n=t,(e=o).prototype=Object.create(n.prototype),e.prototype.constructor=e,u(e,n),o.prototype.onEditorUpdate=function(){var t,e=!0,n=this.state.editorView.state.selection.$anchor.path;for(t=n.length-1;t>=0&&(!n[t].type||n[t].type!==this.state.getSchema().nodes.list_item);t--);var o=n[t]&&n[t].content.content[0];o&&o.type===this.state.getSchema().nodes.list_checkbox||(e=!1),this.$().toggleClass("active",e)},o}(n(0).components.CommandButton)};function l(t){return"paragraph_open"===t.type}function d(t){return"inline"===t.type}var h=function(t){for(var e=!1,n=t.tokens,o=n.length-3;o>=0;o--)if("list_item_open"===n[o].type&&l(n[o+1])&&d(n[o+2])){var r=n[o+2],c=/^\[([ |x|X])\]\s?/.exec(r.content);if(c){var i="x"===c[1]||"X"===c[1];r.content=r.content.slice(c[0].length),r.children[0].content=r.content;var s=new(Object.getPrototypeOf(t).Token)("list_checkbox","input",0);s.hidden=!0,s.attrPush(["type","checkbox"]),i&&s.attrPush(["checked",""]),n.splice(o+1,0,s),e=!0}}return e};var f=function(t){t.core.ruler.push("markdown-it-list-checkbox",h)},k=function(){function t(t,e,n){this.dom=this.contentDOM=document.createElement("li"),this.schema=e.state.schema,this.recalcTaskStatus(t)}var e=t.prototype;return e.update=function(t){this.recalcTaskStatus(t)},e.recalcTaskStatus=function(t){t.content.content[0]&&"list_checkbox"===t.content.content[0].type.name?(this.contentDOM.setAttribute("data-task-id",""),this.contentDOM.setAttribute("data-task-state",t.content.content[0].attrs.checked?"checked":"unchecked")):(this.contentDOM.removeAttribute("data-task-id"),this.contentDOM.removeAttribute("data-task-state"))},t}(),b=function(t,e,n){var o=!!t.attrs.checked,r=document.createElement("input");r.setAttribute("type","checkbox"),r.onclick=function(){var t=n();o=!o,e.dispatch(e.state.tr.setNodeMarkup(t,void 0,{checked:o}))},t.attrs.checked&&r.setAttribute("checked",""),this.dom=this.contentDom=r};function v(){if("askvortsov-rich-text"in flarum.extensions){var t=n(0).components.ProseMirrorMenu,e=p();Object(o.extend)(t.prototype,"items",(function(t){var o,r,c,i;t.add("check_list",e.component({type:"check_list",icon:"fas fa-check-square",tooltip:app.translator.trans("askvortsov-checklist.forum.composer.checklist_tooltip"),state:this.attrs.state,command:(o=this.attrs.state.getSchema().nodes.bullet_list,r=this.attrs.state.getSchema().nodes.list_item,c=this.attrs.state.getSchema().nodes.list_checkbox,i=n(0).wrapInList,function(t,e,n){var s,a=t.selection.$anchor.path;for(s=a.length-1;s>=0&&(!a[s].type||a[s].type!==r);s--);for(s<0&&i(o)(n.state,n.dispatch),s=(a=n.state.selection.$anchor.path).length-1;s>=0&&(!a[s].type||a[s].type!==r);s--);var u=a[s]&&a[s].content.content[0];return u&&u.type===c?e(n.state.tr.delete(a[s+2]-1,a[s+2])):e(n.state.tr.insert(a[s+2],c.create({checked:!1}))),!0})}),10)}));var r=n(0).proseMirror.markdown.MarkdownSerializerBuilder;Object(o.extend)(r.prototype,"buildNodes",(function(t){t.list_checkbox=function(t,e){t.text(e.attrs.checked?"[x] ":"[ ] ",!1)}}));var c=n(0).proseMirror.markdown.MarkdownParserBuilder;Object(o.extend)(c.prototype,"buildTokens",(function(t){a(t,{list_checkbox:{node:"list_checkbox",getAttrs:function(t){return{checked:""===t.attrGet("checked")}}}})})),Object(o.extend)(c.prototype,"buildTokenizer",(function(t){t.use(f)}));var i=n(0).proseMirror.markdown.SchemaBuilder;Object(o.override)(i.prototype,"buildNodes",(function(t){var e=t();return e.update("list_item",a({},e.get("list_item"),{content:"list_checkbox? paragraph block*"})).addBefore("list_item","list_checkbox",{defining:!0,group:"list_checkbox",attrs:{checked:{default:!1}},parseDOM:[{tag:"input[type=checkbox]",getAttrs:function(t){return isElementDOMNode(t)?{checked:t.hasAttribute("checked")}:{}}}],toDOM:function(t){var e={type:"checkbox"};return t.attrs.checked&&(e.checked=""),["input",e]}})}));var s=n(0).proseMirror.ProseMirrorEditorDriver;Object(o.extend)(s.prototype,"buildPluginItems",(function(t){t.add("checkboxEditorPlugin",new(0,n(0).Plugin)({props:{nodeViews:{list_checkbox:function(t,e,n){return new b(t,e,n)},list_item:function(t,e,n){return new k(t,e,n)}}}}))}));var u=n(0).InputRule;Object(o.extend)(s.prototype,"buildInputRules",(function(t){t.push(new u(/^\[([ |x]?)\] $/,(function(t,e,n,o){var r=t.selection.$from;if(r.depth>=3&&"list_item"===r.node(-1).type.name&&0===r.index(-1)){var c={checked:"x"===e[1]},i=r.before(-1);return t.tr.delete(n,o).insert(i+1,t.schema.nodes.list_checkbox.create(c))}return null})))})),Object(o.extend)(s.prototype,"buildPluginItems",(function(t){var e,o,r,c,i,s;t.add("checkListKeymap",n(0).keymap((e=this.schema,{Enter:(o=e.nodes.list_item,r=e.nodes.list_checkbox,c=n(0).liftListItem,i=n(0).splitListItem,s=n(0).Selection,function(t,e,n){var a,u=t.selection.$anchor.path;for(a=u.length-1;a>=0&&(!u[a].type||u[a].type!==o);a--);var p=u[a]&&u[a].content.content[0];if(!p||p.type!==r)return!1;var l=u[a].content.content[1];if(l&&!l.content.content.length)return e(n.state.tr.delete(u[a+2]-1,n.state.selection.to)),n.state.doc.resolve(n.state.selection.from-1),e(n.state.tr.setSelection(s.near(n.state.doc.resolve(t.selection.from-1)))),c(o)(t,e);if(!i(o)(t,e))return!1;var d=n.state.selection.$from.before(-1);return e(n.state.tr.insert(d+1,r.create({checked:!1}))),!0})})),10)}))}}Object(o.extend)(c.a.prototype,"boot",(function(){this.forum.attribute("askvortsov-checklist.cross_out_completed_items")&&$(".App").addClass("checklist-cross-completed")})),app.initializers.add("askvortsov/flarum-checklist",(function(){function t(){var t=this.attrs.post;t.canEdit()&&this.$('input[type="checkbox"]').each((function(e,n){n.disabled=!1,n.onchange=function(){!function(t,e,n){for(var o,r=/([\-\*]|[0-9]+\.) (\[[ xX]\])/g,c=t.content();o=r.exec(c);){if(0===e){var i=o.index+o[0].length-2,s=c.substring(0,i)+(n?"x":" ")+c.substring(i+1);return void t.save({content:s}).then((function(){m.redraw()}))}e--}}(t,e,n.checked)}}))}Object(o.extend)(s.a.prototype,"oncreate",t),Object(o.extend)(s.a.prototype,"onupdate",t),v()}))}]);
//# sourceMappingURL=forum.js.map